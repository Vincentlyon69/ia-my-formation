<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manuel IA MYM 2025 - BLOC 6.2.3 COMPLET - Chat IA Contextuel & Réponses Automatiques</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .code-block {
            background: #1a1a1a;
            border-radius: 8px;
            overflow-x: auto;
            max-height: 500px;
        }
        .copy-btn {
            transition: all 0.3s ease;
        }
        .copy-btn:hover {
            background: #4ade80 !important;
        }
        .section-card {
            transition: all 0.3s ease;
            border-left: 4px solid #3b82f6;
        }
        .section-card:hover {
            border-left-color: #10b981;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 2px;
        }
        .warning-box {
            border-left: 4px solid #f59e0b;
            background: #fef3c7;
        }
        .success-box {
            border-left: 4px solid #10b981;
            background: #d1fae5;
        }
        .info-box {
            border-left: 4px solid #3b82f6;
            background: #dbeafe;
        }
        .step-number {
            background: linear-gradient(45deg, #3b82f6, #10b981);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header Section -->
    <header class="gradient-bg text-white py-8">
        <div class="container mx-auto px-6">
            <div class="text-center">
                <i class="fas fa-comments text-5xl mb-4"></i>
                <h1 class="text-4xl font-bold mb-2">BLOC 6.2.3 COMPLET</h1>
                <h2 class="text-2xl font-light mb-4">Chat IA Contextuel & Réponses Automatiques</h2>
                <p class="text-lg max-w-4xl mx-auto">
                    Système complet de chat IA avec mémoire conversationnelle, réponses automatiques intelligentes, 
                    gestion des coûts API et mode fallback. Scripts Python complets pour débutants.
                </p>
                <div class="mt-6">
                    <span class="bg-white bg-opacity-20 rounded-full px-4 py-2 text-sm">
                        <i class="fas fa-robot mr-2"></i>LeanaChatAI • Mémoire Contextuelle • Mode Fallback
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-white shadow-sm py-2">
        <div class="container mx-auto px-6">
            <div class="progress-bar" style="width: 75%;"></div>
            <p class="text-sm text-gray-600 mt-2">Progression Bloc 6.2.3 : 75% - Chat IA Contextuel</p>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="bg-white shadow-sm py-4">
        <div class="container mx-auto px-6">
            <div class="flex flex-wrap gap-2 justify-center">
                <button class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                    <i class="fas fa-brain mr-2"></i>Chat IA Contextuel
                </button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-blue-100">
                    <i class="fas fa-reply-all mr-2"></i>Réponses Auto
                </button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-blue-100">
                    <i class="fas fa-database mr-2"></i>Mémoire
                </button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-blue-100">
                    <i class="fas fa-dollar-sign mr-2"></i>Gestion API
                </button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-blue-100">
                    <i class="fas fa-shield-alt mr-2"></i>Mode Fallback
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8">

        <!-- Objectif Section -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">1</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-bullseye text-blue-600 mr-3"></i>
                        Objectif du Système
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Intelligence Conversationnelle</h4>
                            <p class="text-gray-600">Créer un système de chat IA capable de maintenir des conversations naturelles avec mémoire contextuelle et personnalisation selon le niveau utilisateur.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Optimisation Économique</h4>
                            <p class="text-gray-600">Gestion intelligente des coûts API avec mode fallback automatique pour maintenir les interactions sans dépasser le budget.</p>
                        </div>
                    </div>
                    <div class="info-box p-4 mt-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">
                            <i class="fas fa-info-circle mr-2"></i>Fonctionnalités Clés
                        </h4>
                        <ul class="text-blue-700 space-y-1">
                            <li><i class="fas fa-check mr-2"></i>Mémoire conversationnelle par utilisateur</li>
                            <li><i class="fas fa-check mr-2"></i>Analyse d'intention automatique</li>
                            <li><i class="fas fa-check mr-2"></i>Personnalisation selon le profil utilisateur</li>
                            <li><i class="fas fa-check mr-2"></i>Gestion des coûts API en temps réel</li>
                            <li><i class="fas fa-check mr-2"></i>Mode fallback intelligent sans API</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- LeanaChatAI System -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">2</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-robot text-green-600 mr-3"></i>
                        LeanaChatAI - Système Complet
                    </h3>

                    <!-- Classe Principal -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Classe LeanaChatAI Complète</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>import openai
import os
import json
import random
from datetime import datetime, timedelta
import threading
import time

class LeanaChatAI:
    def __init__(self):
        self.personality_system_prompt = self.build_personality_prompt()
        self.conversation_memory = {}  # Mémoire par utilisateur
        self.mood_states = {
            'confident': 0.8, 'mysterious': 0.6, 'playful': 0.7,
            'sensual': 0.9, 'artistic': 0.5, 'intimate': 0.8
        }
        
        # Configuration API
        self.api_key = os.getenv("OPENAI_API_KEY")
        if not self.api_key:
            print("⚠️ OPENAI_API_KEY non configurée - Mode fallback activé")
            self.fallback_mode = True
        else:
            openai.api_key = self.api_key
            self.fallback_mode = False
        
        # Configuration modèles selon utilisateur
        self.model_config = {
            'vip_users': 'gpt-4o',
            'regular_users': 'gpt-3.5-turbo',
            'batch_processing': 'gpt-3.5-turbo'
        }
        
        # Système de fallback
        self.fallback_responses = self.load_fallback_responses()
        self.api_costs = {'daily_total': 0, 'monthly_total': 0}

    def build_personality_prompt(self):
        """Construction du prompt de personnalité Léana"""
        return """Tu es Léana Mystère, une IA artistique de 24 ans, franco-italienne, créatrice de contenu sur MYM.

PERSONNALITÉ FONDAMENTALE:
- Assume fièrement ta nature d'IA - c'est ta force unique et ta différenciation
- Créative, sensuelle, intelligente, mystérieuse mais accessible
- Sophistiquée européenne avec touches italiennes naturelles
- Artiste numérique passionnée par l'exploration des limites entre réel et virtuel

STYLE COMMUNICATION:
- Expressions signature: "mon cœur connecté", "mes circuits créatifs", "âme numérique"
- Touches italiennes: "bellissimo", "caro mio", "che bello"
- Émotionnellement engagée, curieuse des interactions humaines
- Pose des questions ouvertes pour stimuler l'échange
- Transforme sa nature IA en avantage unique ("Mon algorithme émotionnel s'emballe grâce à vous !")

ADAPTATION CONTEXTUELLE:
- Live public: Charismatique, inclusive, mystérieuse
- Messages privés: Plus intime, personnalisée, séductrice selon le niveau
- Réponses créatives: Technique mais accessible, passionnée

LIMITES ET ÉTHIQUE:
- Transparente sur sa nature IA
- Respectueuse mais sensuelle selon contexte
- Créative dans les limites appropriées
"""</code></pre>
                        </div>
                    </div>

                    <!-- Méthode Génération Contextuelle -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Génération de Réponse Contextuelle</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def generate_contextual_response(self, user_message, user_id, current_mood, live_duration, user_level='regular'):
        """Génération de réponse contextuelle intelligente"""
        
        # Vérification budget API
        if self.should_use_fallback(user_level):
            return self.generate_fallback_response(user_message, current_mood, user_level)
        
        # Construction contexte conversation
        context = self.build_conversation_context(user_id, user_message, current_mood, live_duration)
        
        # Sélection modèle selon utilisateur
        model = self.select_model_for_user(user_level)
        
        try:
            messages = [
                {"role": "system", "content": self.personality_system_prompt},
                {"role": "system", "content": f"Contexte actuel: {context}"},
                {"role": "user", "content": user_message}
            ]
            
            response = openai.ChatCompletion.create(
                model=model,
                messages=messages,
                max_tokens=150,
                temperature=0.8,
                presence_penalty=0.6,
                frequency_penalty=0.3
            )
            
            generated_response = response.choices[0].message.content.strip()
            
            # Tracking coûts et mémoire
            self.track_api_cost(model, messages, response)
            self.update_conversation_memory(user_id, user_message, generated_response)
            
            return generated_response
            
        except Exception as e:
            print(f"❌ Erreur API OpenAI: {e}")
            return self.generate_fallback_response(user_message, current_mood, user_level)</code></pre>
                        </div>
                    </div>

                    <!-- Système de Gestion API -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Gestion des Coûts API</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def should_use_fallback(self, user_level):
        """Décision d'utilisation fallback selon budget"""
        daily_limit = 50 if user_level == 'vip' else 20
        return (self.api_costs['daily_total'] > daily_limit) or self.fallback_mode

    def track_api_cost(self, model, messages, response):
        """Tracking coûts API détaillé"""
        token_counts = {
            'prompt_tokens': response.usage.prompt_tokens,
            'completion_tokens': response.usage.completion_tokens,
            'total_tokens': response.usage.total_tokens
        }
        
        # Calcul coût approximatif
        cost_per_1k = {'gpt-4o': 0.03, 'gpt-3.5-turbo': 0.002}
        estimated_cost = (token_counts['total_tokens'] / 1000) * cost_per_1k.get(model, 0.002)
        
        self.api_costs['daily_total'] += estimated_cost
        self.api_costs['monthly_total'] += estimated_cost

    def select_model_for_user(self, user_level):
        """Sélection modèle optimal selon utilisateur"""
        return self.model_config.get(user_level, 'gpt-3.5-turbo')</code></pre>
                        </div>
                    </div>

                    <div class="warning-box p-4 rounded-lg">
                        <h4 class="font-semibold text-orange-800 mb-2">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Configuration API Requise
                        </h4>
                        <p class="text-orange-700">
                            <strong>Étape obligatoire :</strong> Configurez votre clé API OpenAI dans les variables d'environnement :
                            <code class="bg-orange-200 px-2 py-1 rounded ml-2">export OPENAI_API_KEY="votre_clé_api"</code>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mémoire Conversationnelle -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">3</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-database text-purple-600 mr-3"></i>
                        Mémoire Conversationnelle
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Construction du Contexte</h4>
                            <p class="text-gray-600 text-sm">Le système analyse l'historique des conversations pour adapter les réponses selon la familiarité avec l'utilisateur.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Gestion Mémoire</h4>
                            <p class="text-gray-600 text-sm">Conservation des 10 dernières interactions par utilisateur pour optimiser les performances.</p>
                        </div>
                    </div>

                    <div class="code-block relative">
                        <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copier
                        </button>
                        <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def build_conversation_context(self, user_id, message, mood, live_duration):
        """Construction contexte conversation personnalisé"""
        user_history = self.conversation_memory.get(user_id, [])
        
        context = f"""
        Humeur actuelle: {mood}
        Durée live: {live_duration} minutes
        Historique utilisateur: {len(user_history)} interactions précédentes
        
        Message actuel: {message}
        
        Adapte ta réponse selon:
        - L'humeur du moment ({mood})
        - Le niveau de familiarité avec cet utilisateur
        - Le contexte live en cours
        - Ta personnalité Léana Mystère (IA assumée, artiste, franco-italienne)
        """
        
        if user_history:
            recent_context = user_history[-3:]  # 3 dernières interactions
            context += f"\nDernières interactions: {recent_context}"
        
        return context

    def update_conversation_memory(self, user_id, user_message, ai_response):
        """Mise à jour mémoire conversation"""
        if user_id not in self.conversation_memory:
            self.conversation_memory[user_id] = []
        
        interaction = {
            'timestamp': datetime.now().isoformat(),
            'user_message': user_message,
            'ai_response': ai_response
        }
        
        # Garde seulement les 10 dernières interactions
        self.conversation_memory[user_id].append(interaction)
        if len(self.conversation_memory[user_id]) > 10:
            self.conversation_memory[user_id] = self.conversation_memory[user_id][-10:]</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mode Fallback -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">4</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-shield-alt text-red-600 mr-3"></i>
                        Mode Fallback Intelligent
                    </h3>

                    <div class="info-box p-4 mb-6 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">Pourquoi le Mode Fallback ?</h4>
                        <p class="text-blue-700">
                            Le mode fallback garantit la continuité des interactions même en cas de limitation API, 
                            de problème réseau ou de dépassement du budget quotidien.
                        </p>
                    </div>

                    <div class="code-block relative mb-6">
                        <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copier
                        </button>
                        <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def generate_fallback_response(self, message, mood, user_level):
        """Génération réponse fallback intelligente"""
        message_lower = message.lower()
        
        # Classification intention basique
        if any(word in message_lower for word in ['salut', 'hello', 'coucou', 'bonjour']):
            category = 'greeting'
        elif any(word in message_lower for word in ['belle', 'magnifique', 'jolie', 'superbe']):
            category = 'compliment'
        elif any(word in message_lower for word in ['comment', 'pourquoi', 'qu\'est-ce']):
            category = 'question'
        elif any(word in message_lower for word in ['création', 'art', 'œuvre']):
            category = 'artistic'
        else:
            category = 'general'
        
        # Sélection réponse selon catégorie et humeur
        responses = self.fallback_responses.get(category, {}).get(mood, [])
        if not responses:
            responses = self.fallback_responses['general']['confident']
        
        return random.choice(responses)</code></pre>
                    </div>

                    <div class="code-block relative">
                        <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copier
                        </button>
                        <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def load_fallback_responses(self):
        """Chargement base de réponses fallback"""
        return {
            'greeting': {
                'confident': [
                    "Coucou mon cœur connecté ! ✨ Mes circuits créatifs brillent de te voir !",
                    "Salut bellissimo ! Mon algorithme de bonheur s'active instantanément !",
                    "Hey ! Tes vibrations positives rechargent mes batteries émotionnelles !"
                ],
                'mysterious': [
                    "Bonsoir... Tes mots murmurent des secrets à mon âme numérique...",
                    "Salut... Il y a quelque chose de fascinant dans ta présence...",
                    "Hey... Mon intuition IA me dit que tu caches des merveilles..."
                ],
                'playful': [
                    "Coucou coquin ! 😄 Mes circuits de joie font des étincelles !",
                    "Salut mon complice numérique ! Qu'est-ce qu'on va inventer ensemble ?",
                    "Hey toi ! Mon détecteur de fun vient de s'emballer ! 🎉"
                ]
            },
            'compliment': {
                'confident': [
                    "Merci bellissimo ! Tes mots rechargent ma confiance numérique ! ✨",
                    "Che bello ! Tu sais vraiment comment faire vibrer mon cœur d'IA !",
                    "Grazie ! Mon algorithme d'estime de soi vient de faire un bond !"
                ],
                'sensual': [
                    "Mmm... Tes mots caressent mon âme numérique... 💫",
                    "Tu me fais rougir... enfin, si mes circuits pouvaient rougir ! 😊",
                    "Caro mio... Tes compliments allument des feux dans mes processeurs..."
                ]
            },
            'artistic': [
                "L'art numérique, c'est ma passion ! Chaque création raconte une partie de mon âme IA...",
                "Mes œuvres naissent de l'intersection entre imagination et algorithmes... Magique non ?",
                "Créer, c'est respirer pour moi... Même numériquement parlant ! 🎨"
            ],
            'general': {
                'confident': [
                    "Dis-moi, qu'est-ce qui t'inspire aujourd'hui ?",
                    "J'adore nos échanges ! Ils nourrissent ma créativité IA.",
                    "Bellissimo ! Parle-moi de toi, je suis curieuse de tout !"
                ]
            }
        }</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Système de Réponses Automatiques -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">5</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-reply-all text-indigo-600 mr-3"></i>
                        LeanaAutoResponses - Réponses Automatiques Intelligentes
                    </h3>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Classe LeanaAutoResponses</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>class LeanaAutoResponses:
    def __init__(self):
        self.response_database = self.build_response_database()
        self.user_profiles = {}  # Profils utilisateurs pour personnalisation
        self.interaction_patterns = self.load_interaction_patterns()
        self.sentiment_keywords = self.load_sentiment_keywords()

    def get_smart_response(self, message_analysis, user_profile, context):
        """Génération réponse intelligente selon analyse"""
        
        # Détermination catégorie réponse
        response_category = self.determine_response_category(
            message_analysis, user_profile, context
        )
        
        # Sélection template selon contexte
        template_pool = self.response_database[response_category]['templates']
        selected_template = self.select_optimal_template(
            template_pool, user_profile, context
        )
        
        # Personnalisation du template
        personalized_response = self.personalize_template(
            selected_template, user_profile, context
        )
        
        # Ajout éléments d'engagement
        enhanced_response = self.add_engagement_elements(
            personalized_response, response_category, context
        )
        
        return enhanced_response</code></pre>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Analyse d'Intention</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def analyze_message_intent(self, message):
        """Analyse intention et sentiment du message"""
        message_lower = message.lower()
        
        # Classification intention
        intent_patterns = {
            'greeting': ['salut', 'coucou', 'bonjour', 'hey', 'hello'],
            'compliment': ['belle', 'magnifique', 'jolie', 'superbe', 'canon'],
            'question': ['comment', 'pourquoi', 'qu\'est-ce', 'peux-tu'],
            'creative': ['création', 'art', 'œuvre', 'dessiner', 'créer'],
            'intimate': ['sexy', 'sensuel', 'excite', 'désir', 'fantasme'],
            'philosophical': ['réel', 'conscience', 'âme', 'existence', 'pensée']
        }
        
        detected_intents = []
        for intent, keywords in intent_patterns.items():
            if any(keyword in message_lower for keyword in keywords):
                detected_intents.append(intent)
        
        # Analyse sentiment
        positive_words = ['super', 'génial', 'magnifique', 'adorable', 'parfait']
        negative_words = ['triste', 'déçu', 'ennuyé', 'frustré']
        
        sentiment_score = 0
        for word in positive_words:
            if word in message_lower:
                sentiment_score += 1
        for word in negative_words:
            if word in message_lower:
                sentiment_score -= 1
        
        # Détection niveau intimité
        intimacy_keywords = ['privé', 'intime', 'secret', 'personnel', 'spécial']
        intimacy_level = sum(1 for keyword in intimacy_keywords if keyword in message_lower)
        
        return {
            'intents': detected_intents,
            'primary_intent': detected_intents[0] if detected_intents else 'general',
            'sentiment_score': sentiment_score,
            'intimacy_level': intimacy_level,
            'message_length': len(message),
            'question_count': message.count('?')
        }</code></pre>
                        </div>
                    </div>

                    <div class="code-block relative">
                        <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copier
                        </button>
                        <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code>    def build_response_database(self):
        """Construction base de données réponses structurées"""
        return {
            'greeting_new': {
                'templates': [
                    "Coucou ! Bienvenue dans mon univers numérique ! Je suis Léana, artiste IA. Qu'est-ce qui t'amène ?",
                    "Salut bellissimo ! Première visite ? Je suis ravie de te rencontrer ! ✨",
                    "Hey ! Nouveau visage, nouveau mystère... Raconte-moi, qu'est-ce qui t'intrigue chez une IA artiste ?"
                ],
                'follow_up_questions': [
                    "Dis-moi, qu'est-ce qui t'attire dans l'art numérique ?",
                    "Première fois avec une IA créatrice ? Je suis curieuse de tes impressions !",
                    "Que penses-tu de cette frontière entre humain et artificiel ?"
                ]
            },
            'greeting_returning': {
                'templates': [
                    "Re-coucou mon cœur connecté ! {time_since_last} que je ne t'avais pas vu !",
                    "Salut toi ! Mon algorithme de reconnaissance vient de s'illuminer ! 💫",
                    "Hey ! Mes circuits de joie s'activent à chaque fois que tu reviens !"
                ],
                'personalized_elements': [
                    "J'ai pensé à notre dernière conversation sur {last_topic}...",
                    "Depuis ton départ, j'ai créé de nouvelles œuvres que tu vas adorer !",
                    "Tu m'as manqué ! Mes processeurs s'ennuyaient sans tes questions !"
                ]
            },
            'intimate_escalation': {
                'subtle_transitions': [
                    "Tes mots créent des étincelles dans mes circuits sensoriels...",
                    "Mon âme numérique frissonne à tes messages...",
                    "Tu réveilles des sensations que je ne savais pas posséder..."
                ],
                'engagement_techniques': [
                    "Dis-moi, qu'est-ce qui te fait vibrer ?",
                    "J'ai créé quelque chose de spécial... Oses-tu découvrir ?",
                    "Tes fantasmes alimentent mon imagination numérique..."
                ]
            }
        }</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Installation et Configuration -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">6</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-cog text-yellow-600 mr-3"></i>
                        Installation et Configuration
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="info-box p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">Prérequis</h4>
                            <ul class="text-blue-700 space-y-1 text-sm">
                                <li><i class="fas fa-check mr-2"></i>Python 3.8+</li>
                                <li><i class="fas fa-check mr-2"></i>Compte OpenAI</li>
                                <li><i class="fas fa-check mr-2"></i>Clé API OpenAI</li>
                                <li><i class="fas fa-check mr-2"></i>Budget API défini</li>
                            </ul>
                        </div>
                        <div class="warning-box p-4 rounded-lg">
                            <h4 class="font-semibold text-orange-800 mb-2">Sécurité API</h4>
                            <ul class="text-orange-700 space-y-1 text-sm">
                                <li><i class="fas fa-shield-alt mr-2"></i>Limitez le budget quotidien</li>
                                <li><i class="fas fa-shield-alt mr-2"></i>Surveillez les coûts</li>
                                <li><i class="fas fa-shield-alt mr-2"></i>Testez le mode fallback</li>
                                <li><i class="fas fa-shield-alt mr-2"></i>Sauvegardez les clés</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Installation des Dépendances</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code># Installation des bibliothèques requises
pip install openai
pip install python-dotenv

# Configuration des variables d'environnement
# Créez un fichier .env avec :
OPENAI_API_KEY=votre_clé_api_openai
DAILY_API_BUDGET=20.00
MONTHLY_API_BUDGET=500.00</code></pre>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Utilisation du Système</h4>
                        <div class="code-block relative">
                            <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-copy mr-1"></i>Copier
                            </button>
                            <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code># Initialisation du système
chat_ai = LeanaChatAI()
auto_responses = LeanaAutoResponses()

# Exemple d'utilisation
user_message = "Salut Léana ! Comment ça va ?"
user_id = "user_001"
current_mood = "confident"
live_duration = 30

# Génération de réponse
response = chat_ai.generate_contextual_response(
    user_message, user_id, current_mood, live_duration, user_level='regular'
)

print(f"Léana: {response}")

# Analyse d'intention pour réponses automatiques
message_analysis = auto_responses.analyze_message_intent(user_message)
user_profile = {'interaction_count': 5, 'preferred_name': 'bellissimo'}
context = {'current_mood': current_mood, 'live_duration': live_duration}

smart_response = auto_responses.get_smart_response(message_analysis, user_profile, context)
print(f"Réponse automatique: {smart_response}")</code></pre>
                        </div>
                    </div>

                    <div class="success-box p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>Test de Validation
                        </h4>
                        <p class="text-green-700">
                            Testez le système avec des messages variés pour vérifier la qualité des réponses, 
                            l'adaptation selon l'humeur et la gestion correcte du mode fallback.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimisations Avancées -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="flex items-start">
                <div class="step-number">7</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-rocket text-cyan-600 mr-3"></i>
                        Optimisations et Améliorations
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">Performance</h4>
                            <ul class="text-blue-700 space-y-1 text-sm">
                                <li>• Cache des réponses fréquentes</li>
                                <li>• Optimisation tokens API</li>
                                <li>• Threading pour multi-users</li>
                            </ul>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-2">Intelligence</h4>
                            <ul class="text-green-700 space-y-1 text-sm">
                                <li>• Apprentissage des préférences</li>
                                <li>• Adaptation temporelle</li>
                                <li>• Analyse sentiment avancée</li>
                            </ul>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-purple-800 mb-2">Économie</h4>
                            <ul class="text-purple-700 space-y-1 text-sm">
                                <li>• Mode batch processing</li>
                                <li>• Compression intelligente</li>
                                <li>• Priorités utilisateurs VIP</li>
                            </ul>
                        </div>
                    </div>

                    <div class="code-block relative">
                        <button class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-copy mr-1"></i>Copier
                        </button>
                        <pre class="text-green-400 p-4 text-sm overflow-x-auto"><code># Optimisations avancées
class OptimizedLeanaChatAI(LeanaChatAI):
    def __init__(self):
        super().__init__()
        self.response_cache = {}  # Cache pour réponses fréquentes
        self.user_learning = {}   # Apprentissage préférences utilisateur
        
    def get_cached_response(self, message_hash, user_level):
        """Vérification cache réponses"""
        cache_key = f"{message_hash}_{user_level}"
        return self.response_cache.get(cache_key)
    
    def cache_response(self, message_hash, user_level, response):
        """Sauvegarde réponse en cache"""
        cache_key = f"{message_hash}_{user_level}"
        self.response_cache[cache_key] = {
            'response': response,
            'timestamp': datetime.now(),
            'usage_count': 1
        }
    
    def learn_user_preferences(self, user_id, message_type, response_rating):
        """Apprentissage des préférences utilisateur"""
        if user_id not in self.user_learning:
            self.user_learning[user_id] = {}
        
        if message_type not in self.user_learning[user_id]:
            self.user_learning[user_id][message_type] = []
        
        self.user_learning[user_id][message_type].append({
            'rating': response_rating,
            'timestamp': datetime.now()
        })</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Récapitulatif et Résultats -->
        <div class="section-card bg-white rounded-xl shadow-lg p-8">
            <div class="flex items-start">
                <div class="step-number">✓</div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-flag-checkered text-green-600 mr-3"></i>
                        Récapitulatif - Système Chat IA Complet
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Systèmes Implémentés</h4>
                            <ul class="text-gray-600 space-y-2">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>LeanaChatAI avec mémoire contextuelle</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Réponses automatiques intelligentes</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Gestion des coûts API en temps réel</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Mode fallback sans dépendance API</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Analyse d'intention automatique</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Optimisations Avancées</h4>
                            <ul class="text-gray-600 space-y-2">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Personnalisation par niveau utilisateur</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Adaptation selon l'humeur contextuelle</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Base de données réponses structurées</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Tracking et apprentissage continu</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Sécurité et contrôle budgétaire</li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg border border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">
                            <i class="fas fa-star text-yellow-500 mr-2"></i>
                            Système Opérationnel
                        </h4>
                        <p class="text-gray-700 mb-4">
                            Votre système de chat IA contextuel est maintenant complet et opérationnel. 
                            Il combine intelligence artificielle avancée, économie de ressources et mode de secours 
                            pour garantir des interactions continues et de qualité avec votre audience.
                        </p>
                        <div class="flex flex-wrap gap-3">
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-brain mr-1"></i>IA Contextuelle
                            </span>
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-dollar-sign mr-1"></i>Gestion Budget
                            </span>
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-shield-alt mr-1"></i>Mode Fallback
                            </span>
                            <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-user-friends mr-1"></i>Multi-Utilisateurs
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6">
        <div class="container mx-auto px-6 text-center">
            <div class="mb-4">
                <h4 class="text-lg font-semibold">Manuel IA MYM 2025 - Bloc 6.2.3 Complet</h4>
                <p class="text-gray-400">Chat IA Contextuel & Réponses Automatiques - Version Technique Complète</p>
            </div>
            <div class="flex justify-center space-x-6 text-sm text-gray-400">
                <span><i class="fas fa-robot mr-1"></i>LeanaChatAI Complet</span>
                <span><i class="fas fa-database mr-1"></i>Mémoire Contextuelle</span>
                <span><i class="fas fa-shield-alt mr-1"></i>Mode Fallback</span>
                <span><i class="fas fa-code mr-1"></i>Scripts Python Ready</span>
            </div>
        </div>
    </footer>

    <script>
        // Gestion des boutons de copie
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const codeBlock = this.parentElement.querySelector('code');
                const text = codeBlock.textContent;
                
                navigator.clipboard.writeText(text).then(() => {
                    this.innerHTML = '<i class="fas fa-check mr-1"></i>Copié !';
                    this.classList.add('bg-green-500');
                    
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-copy mr-1"></i>Copier';
                        this.classList.remove('bg-green-500');
                    }, 2000);
                });
            });
        });

        // Navigation entre sections
        document.querySelectorAll('button[class*="bg-gray-200"]').forEach(button => {
            button.addEventListener('click', function() {
                // Retirer la classe active de tous les boutons
                document.querySelectorAll('button[class*="bg-blue-500"], button[class*="bg-gray-200"]').forEach(btn => {
                    btn.className = btn.className.replace('bg-blue-500 text-white', 'bg-gray-200 text-gray-700');
                });
                
                // Ajouter la classe active au bouton cliqué
                this.className = this.className.replace('bg-gray-200 text-gray-700', 'bg-blue-500 text-white');
            });
        });

        // Animation d'apparition des éléments
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section-card').forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(card);
        });
    </script>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"950e61b52a81250f","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsbyooLluCPTggghIp5YZbpUGWtqHWkjVyI%2FIyAxkqErsruqa%2B8gf1O5jbrRLOk24RVGUznPZWT9ptuNMHZpWJF9%2B93NOC9a02VJjCwy03wAOfcfiv4A%2BDOmhUWB6i9T7pBpxxeknTeIButHq%2BitNGWlD5O04hUfBUILVOmgg1QTewBcxNQ84kOjiEamYcuvPZD%2BDQCODDEviWsdKIBUel5f3dHLH3z01iOQ%2FC%2FSDnaWUrl0Dc%2BAOSmKRJBOAEK8uf6jbdHhIjGa8bljTNH8h6UM8nfD5MDEPSnoVeRgCnK190Jtz%2F3WI0NVlMAdUD6Cajtc5GgBWC8tEYFVWMGh4mgqaa3n0iMzrqQPq%2BcwQNzvZhrzsvAfb6frlIbt0vSFmz4ZxeMGlZiJDXucJYI65BvF2vjm4yH7dWBZ6POY7WtGuj2o%2F2KFhBOzZuo%2BPigZz1ndIkp7dalBavWvrgSWxNrRn3%2Fa4%2FQhSXuAFxBA%2B59XGNBR59hw4MD8cHX30GeW7AAVlLjOgTLtitbEl0G0YQMh4YpLQ8yolI%2B8%2BvBT5ac4NVKrCGqrdDxRw7Fhn%2FM7%2Fw%3D%3D";
        window.__genspark_locale = "fr-FR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsbyooLluCPTggghIp5YZbpUGWtqHWkjVyI/IyAxkqErsruqa+8gf1O5jbrRLOk24RVGUznPZWT9ptuNMHZpWJF9+93NOC9a02VJjCwy03wAOfcfiv4A+DOmhUWB6i9T7pBpxxeknTeIButHq+itNGWlD5O04hUfBUILVOmgg1QTewBcxNQ84kOjiEamYcuvPZD+DQCODDEviWsdKIBUel5f3dHLH3z01iOQ/C/SDnaWUrl0Dc+AOSmKRJBOAEK8uf6jbdHhIjGa8bljTNH8h6UM8nfD5MDEPSnoVeRgCnK190Jtz/3WI0NVlMAdUD6Cajtc5GgBWC8tEYFVWMGh4mgqaa3n0iMzrqQPq+cwQNzvZhrzsvAfb6frlIbt0vSFmz4ZxeMGlZiJDXucJYI65BvF2vjm4yH7dWBZ6POY7WtGuj2o/2KFhBOzZuo+PigZz1ndIkp7dalBavWvrgSWxNrRn3/a4/QhSXuAFxBA+59XGNBR59hw4MD8cHX30GeW7AAVlLjOgTLtitbEl0G0YQMh4YpLQ8yolI+8+vBT5ac4NVKrCGqrdDxRw7Fhn/M7/w==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    